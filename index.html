<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦ğŸ’ŒğŸ¦¤ ë¯¸ìƒˆì™€ ë„ë„ì˜ ë¹„ë°€ ìš°ì²´í†µ</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ë¡œë”© í™”ë©´ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-text {
            font-size: 24px;
            margin-top: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading-birds {
            font-size: 48px;
            animation: flap 0.6s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes flap {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .container.visible {
            opacity: 1;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #333;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .main-button {
            padding: 20px;
            font-size: 20px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .main-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .main-button:active {
            transform: translateY(0px);
        }

        /* í¸ì§€í•¨ í™”ë©´ */
        .mailbox-view {
            display: none;
            text-align: left;
        }

        .mailbox-view.active {
            display: block;
        }

        .mailbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: #f0f0f0;
            cursor: pointer;
            font-size: 16px;
        }

        .back-button:hover {
            background: #e0e0e0;
        }

        .write-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .write-section textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 10px;
        }

        .write-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-row {
            display: flex;
            gap: 10px;
        }

        .send-button, .random-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .random-button {
            background: #ffd700;
            color: #333;
        }

        .send-button:hover, .random-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .messages-section {
            margin-top: 30px;
        }

        .messages-section h3 {
            margin-bottom: 15px;
            color: #666;
        }

        .message-card {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .message-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .message-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-delete-btn {
            padding: 4px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .message-delete-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .message-text {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .message-reactions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .reaction-button {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .reaction-button:hover {
            transform: scale(1.2);
            border-color: #667eea;
        }

        .reaction-button.active {
            background: #667eea;
        }

        .no-messages {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .random-loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #666;
        }

        .random-loading.active {
            display: block;
        }

        /* íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .todo-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: left;
        }

        .todo-section h3 {
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .todo-input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .todo-input-wrapper input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
        }

        .todo-input-wrapper input:focus {
            outline: none;
            border-color: #667eea;
        }

        .todo-add-button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .todo-add-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .todo-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .todo-item:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .todo-text {
            flex: 1;
            font-size: 16px;
            color: #333;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #999;
        }

        .todo-delete {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            background: #ff6b6b;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .todo-delete:hover {
            background: #ff5252;
        }

        .todo-empty {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-birds">ğŸ¦ğŸ¦¤</div>
        <div class="loading-text">ë¡œë”© ì¤‘.. íŒŒë‹¥íŒŒë‹¥! ğŸ¦ğŸ©¶ğŸ¦¤â¤ï¸</div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div class="container" id="mainContainer">
        <div id="homeView">
            <h1>ğŸ¦ğŸ’ŒğŸ¦¤<br>ë¯¸ìƒˆì™€ ë„ë„ì˜ ë¹„ë°€ ìš°ì²´í†µ</h1>
            
            <!-- íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div class="todo-section">
                <h3>ìš°ë¦¬ì˜ í•  ì¼ âœ…</h3>
                <div class="todo-input-wrapper">
                    <input type="text" id="todoInput" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." />
                    <button class="todo-add-button" onclick="addTodo()">ì¶”ê°€</button>
                </div>
                <div id="todoList" class="todo-list"></div>
            </div>

            <div class="button-group">
                <button class="main-button" onclick="openMailbox('bird')">
                    ğŸ¦ì—ê²Œ í¸ì§€ ë‚¨ê¸°ê¸°
                </button>
                <button class="main-button" onclick="openMailbox('dodo')">
                    ğŸ¦¤ì—ê²Œ í¸ì§€ ë‚¨ê¸°ê¸°
                </button>
            </div>
        </div>

        <!-- ğŸ¦ í¸ì§€í•¨ -->
        <div class="mailbox-view" id="birdMailbox">
            <div class="mailbox-header">
                <h2>ğŸ¦ ë¯¸ìƒˆì—ê²Œ í¸ì§€ ì“°ê¸°</h2>
                <button class="back-button" onclick="goHome()">â† ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div class="write-section">
                <textarea id="birdMessage" placeholder="ë¯¸ìƒˆì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ ì¨ ì£¼ì„¸ìš”... ğŸ’™"></textarea>
                <div class="random-loading" id="birdRandomLoading">âœ¨ íŒŒë‹¥íŒŒë‹¥ ë©”ì‹œì§€ ìƒì„± ì¤‘...</div>
                <div class="button-row">
                    <button class="random-button" onclick="generateRandomMessage('bird')">âœ¨ ëœë¤ ë©”ì‹œì§€</button>
                    <button class="send-button" onclick="sendMessage('bird')">ğŸ’Œ ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <div class="messages-section">
                <h3>ğŸ“¬ ì§€ë‚œ í¸ì§€ë“¤</h3>
                <div id="birdMessages"></div>
            </div>
        </div>

        <!-- ğŸ¦¤ í¸ì§€í•¨ -->
        <div class="mailbox-view" id="dodoMailbox">
            <div class="mailbox-header">
                <h2>ğŸ¦¤ ë„ë„ì—ê²Œ í¸ì§€ ì“°ê¸°</h2>
                <button class="back-button" onclick="goHome()">â† ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div class="write-section">
                <textarea id="dodoMessage" placeholder="ë„ë„ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ì„ ì¨ ì£¼ì„¸ìš”... ğŸ’™"></textarea>
                <div class="random-loading" id="dodoRandomLoading">âœ¨ í‘¸ë“œë•í‘¸ë“œë• ë©”ì‹œì§€ ìƒì„± ì¤‘...</div>
                <div class="button-row">
                    <button class="random-button" onclick="generateRandomMessage('dodo')">âœ¨ ëœë¤ ë©”ì‹œì§€</button>
                    <button class="send-button" onclick="sendMessage('dodo')">ğŸ’Œ ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <div class="messages-section">
                <h3>ğŸ“¬ ì§€ë‚œ í¸ì§€ë“¤</h3>
                <div id="dodoMessages"></div>
            </div>
        </div>
    </div>

    <script>
        // ============ Firebase ì´ˆê¸°í™” ============
        const firebaseConfig = {
            apiKey: "AIzaSyAR7uduL1JkHflpMMTY4mEmZdtoY0p--I4",
            authDomain: "misae-dodo-mailbox.firebaseapp.com",
            projectId: "misae-dodo-mailbox",
            storageBucket: "misae-dodo-mailbox.firebasestorage.app",
            messagingSenderId: "93143777718",
            appId: "1:93143777718:web:1037241c4ce734d20f0117"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Gemini API ì„¤ì •
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE';

        // ë¡œë”© í™”ë©´
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainContainer').classList.add('visible');
                loadTodos(); // íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
            }, 1500);
        });

        // ============ íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ (Firebase) ============
        const todosRef = db.collection('todos');

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (!text) {
                alert('í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ’­');
                return;
            }

            todosRef.add({
                text: text,
                completed: false,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                input.value = '';
                console.log('íˆ¬ë‘ ì¶”ê°€ ì™„ë£Œ!');
            }).catch((error) => {
                console.error('íˆ¬ë‘ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('íˆ¬ë‘ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢');
            });
        }

        function toggleTodo(id, currentStatus) {
            todosRef.doc(id).update({
                completed: !currentStatus
            }).catch((error) => {
                console.error('íˆ¬ë‘ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            });
        }

        function deleteTodo(id) {
            if (confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) {
                todosRef.doc(id).delete().catch((error) => {
                    console.error('íˆ¬ë‘ ì‚­ì œ ì˜¤ë¥˜:', error);
                });
            }
        }

        function loadTodos() {
            // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            todosRef.orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                const container = document.getElementById('todoList');
                
                if (snapshot.empty) {
                    container.innerHTML = '<div class="todo-empty">ì•„ì§ í•  ì¼ì´ ì—†ì–´ìš” ğŸ“</div>';
                    return;
                }

                const todos = [];
                snapshot.forEach((doc) => {
                    todos.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                container.innerHTML = todos.map(todo => `
                    <div class="todo-item ${todo.completed ? 'completed' : ''}">
                        <input 
                            type="checkbox" 
                            class="todo-checkbox" 
                            ${todo.completed ? 'checked' : ''} 
                            onchange="toggleTodo('${todo.id}', ${todo.completed})"
                        />
                        <span class="todo-text">${todo.text}</span>
                        <button class="todo-delete" onclick="deleteTodo('${todo.id}')">ì‚­ì œ</button>
                    </div>
                `).join('');
            }, (error) => {
                console.error('íˆ¬ë‘ ë¡œë“œ ì˜¤ë¥˜:', error);
            });
        }

        // Enter í‚¤ë¡œ íˆ¬ë‘ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            const todoInput = document.getElementById('todoInput');
            if (todoInput) {
                todoInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTodo();
                    }
                });
            }
        });

        // ============ ê¸°ì¡´ ë©”ì‹œì§€ ê¸°ëŠ¥ ============

        // ============ ë©”ì‹œì§€ ê¸°ëŠ¥ (Firebase) ============
        const messagesRef = db.collection('messages');

        function sendMessage(recipient) {
            const textarea = document.getElementById(`${recipient}Message`);
            const message = textarea.value.trim();
            
            if (!message) {
                alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ’­');
                return;
            }

            messagesRef.add({
                recipient: recipient,
                text: message,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                reactions: {}
            }).then(() => {
                textarea.value = '';
                alert(recipient === 'bird' ? 'ğŸ¦ ë¯¸ìƒˆì—ê²Œ í¸ì§€ê°€ ì „ë‹¬ë˜ì—ˆì–´ìš”!' : 'ğŸ¦¤ ë„ë„ì—ê²Œ í¸ì§€ê°€ ì „ë‹¬ë˜ì—ˆì–´ìš”!');
            }).catch((error) => {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                alert('ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢');
            });
        }

        function loadMessages(recipient) {
            const container = document.getElementById(`${recipient}Messages`);
            
            // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            messagesRef
                .where('recipient', '==', recipient)
                .orderBy('date', 'desc')
                .onSnapshot((snapshot) => {
                    if (snapshot.empty) {
                        container.innerHTML = '<div class="no-messages">ì•„ì§ í¸ì§€ê°€ ì—†ì–´ìš” ğŸ“­</div>';
                        return;
                    }

                    const messages = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        messages.push({
                            id: doc.id,
                            ...data,
                            date: data.date ? data.date.toDate() : new Date()
                        });
                    });

                    container.innerHTML = messages.map((msg) => {
                        const date = msg.date;
                        const dateStr = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
                        
                        const reactionButtons = ['ğŸ¦', 'ğŸ¦¤', 'â¤ï¸', 'ğŸ˜‚', 'ğŸŒŸ', 'ğŸ€'].map(emoji => {
                            const count = msg.reactions[emoji] || 0;
                            return `<button class="reaction-button ${count > 0 ? 'active' : ''}" onclick="addReaction('${msg.id}', '${emoji}')">
                                ${emoji} ${count > 0 ? count : ''}
                            </button>`;
                        }).join('');

                        return `
                            <div class="message-card">
                                <div class="message-date">
                                    ${dateStr}
                                    <button class="message-delete-btn" onclick="deleteMessage('${msg.id}')" title="ë©”ì‹œì§€ ì‚­ì œ">ğŸ—‘ï¸</button>
                                </div>
                                <div class="message-text">${msg.text}</div>
                                <div class="message-reactions">${reactionButtons}</div>
                            </div>
                        `;
                    }).join('');
                }, (error) => {
                    console.error('ë©”ì‹œì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                });
        }

        function deleteMessage(messageId) {
            if (confirm('ì´ ë©”ì‹œì§€ë¥¼ ì‚­ì œí• ê¹Œìš”? ğŸ—‘ï¸')) {
                messagesRef.doc(messageId).delete()
                    .then(() => {
                        console.log('ë©”ì‹œì§€ ì‚­ì œ ì™„ë£Œ!');
                    })
                    .catch((error) => {
                        console.error('ë©”ì‹œì§€ ì‚­ì œ ì˜¤ë¥˜:', error);
                        alert('ë©”ì‹œì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢');
                    });
            }
        }

        function addReaction(messageId, emoji) {
            messagesRef.doc(messageId).get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    const reactions = data.reactions || {};
                    reactions[emoji] = (reactions[emoji] || 0) + 1;
                    
                    return messagesRef.doc(messageId).update({ reactions: reactions });
                }
            }).catch((error) => {
                console.error('ë°˜ì‘ ì¶”ê°€ ì˜¤ë¥˜:', error);
            });
        }

        // í™”ë©´ ì „í™˜
        function openMailbox(recipient) {
            document.getElementById('homeView').style.display = 'none';
            document.getElementById(`${recipient}Mailbox`).classList.add('active');
            loadMessages(recipient);
        }

        function goHome() {
            document.querySelectorAll('.mailbox-view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById('homeView').style.display = 'block';
        }

        // ============ Gemini API ëœë¤ ë©”ì‹œì§€ ============

        // í˜ë¥´ì†Œë‚˜ ì •ì˜
        const personas = {
            bird: {
                name: 'ë¯¸ìƒˆ',
                emoji: 'ğŸ¦',
                mbti: 'ENFJ 4w3 so/sx',
                age: 32,
                gender: 'female',
                traits: 'ì±…ì„ ì‚¬ë‘í•˜ëŠ” ë¬¸í•™ì†Œë…€, ê°ì„±ì ì´ê³  ë”°ëœ»í•¨, ìì‹ ì„ ì¢ŒíŒŒë¼ê³  í•¨',
                relationship: 'ë„ë„ì˜ ì—¬ìì¹œêµ¬',
                startDate: '2024ë…„ 6ì›” 13ì¼',
                jargon: ['ì¢ŒíŒŒ', 'íŒŒë‹¥íŒŒë‹¥', 'í‘¸ë“œë•í‘¸ë“œë•', 'ë¼ì´ë‹¤ on!'],
                writingStyle: 'ì¥ë‚œìŠ¤ëŸ½ì§€ë§Œ ë‹¤ì •í•œ ëŠë‚Œ, ë¬¸í•™ì  í‘œí˜„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©, ë”°ëœ»í•˜ê³  ì‘ì›í•˜ëŠ” ë©”ì‹œì§€'
            },
            dodo: {
                name: 'ë„ë„',
                emoji: 'ğŸ¦¤',
                mbti: 'ENTJ 8w9 so/sx',
                age: 43,
                gender: 'male',
                traits: 'ì˜ì–´ êµìœ¡ ì½˜í…ì¸  íšŒì‚¬ì˜ CEO, ëˆì„ ì¢‹ì•„í•˜ê³  ë¶€ìê°€ ë˜ê³  ì‹¶ì–´í•¨, ë¯¸ìƒˆë¥¼ ìš°íŒŒë¼ê³  ë†€ë¦¼',
                relationship: 'ë¯¸ìƒˆì˜ ë‚¨ìì¹œêµ¬',
                startDate: '2024ë…„ 6ì›” 13ì¼',
                jargon: ['ìš°íŒŒ', 'ë¶€ì', 'íŒŒë‹¥íŒŒë‹¥', 'í‘¸ë“œë•í‘¸ë“œë•', 'ë¼ì´ë‹¤ on!'],
                writingStyle: 'ì¥ë‚œìŠ¤ëŸ½ì§€ë§Œ ë‹¤ì •í•œ ëŠë‚Œ, ë¦¬ë”ì‹­ìˆê³  ë“ ë“ í•œ ë§íˆ¬, ìœ ë¨¸ì™€ ì• ì •ì´ ì„ì¸ ë©”ì‹œì§€'
            }
        };

        // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
        function createSystemPrompt(sender, recipient) {
            const senderPersona = sender === 'dodo' ? personas.dodo : personas.bird;
            const recipientPersona = recipient === 'bird' ? personas.bird : personas.dodo;
            
            return `ë‹¹ì‹ ì€ ${senderPersona.name}(${senderPersona.emoji})ì…ë‹ˆë‹¤.

# ë‹¹ì‹ ì˜ ì •ë³´
- MBTI/ì—ë‹ˆì–´ê·¸ë¨: ${senderPersona.mbti}
- ë‚˜ì´: ${senderPersona.age}ì„¸ ${senderPersona.gender}
- íŠ¹ì§•: ${senderPersona.traits}
- ê´€ê³„: ${senderPersona.relationship}
- ë§Œë‚œ ë‚ : ${senderPersona.startDate}

# ìƒëŒ€ë°© ì •ë³´
- ì´ë¦„: ${recipientPersona.name}(${recipientPersona.emoji})
- MBTI/ì—ë‹ˆì–´ê·¸ë¨: ${recipientPersona.mbti}
- ë‚˜ì´: ${recipientPersona.age}ì„¸ ${recipientPersona.gender}
- íŠ¹ì§•: ${recipientPersona.traits}

# ë‘˜ë§Œì˜ jargon/ë†ë‹´
${senderPersona.jargon.map(j => `- ${j}`).join('\n')}

# ë¯¸ì…˜
${recipientPersona.name}ì—ê²Œ ë³´ë‚¼ ì§§ê³  ë‹¤ì •í•œ í¸ì§€ ë©”ì‹œì§€ë¥¼ 1-3ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.

# ì‘ì„± ê°€ì´ë“œ
- ${senderPersona.writingStyle}
- ìì—°ìŠ¤ëŸ½ê²Œ ë‘˜ë§Œì˜ jargonì„ ê°€ë” ì‚¬ìš©í•´ë„ ì¢‹ìŒ (ë„ˆë¬´ ì–µì§€ë¡œ ë„£ì§€ ë§ ê²ƒ)
- ì§„ì‹¬ì´ ë‹´ê¸´ ë©”ì‹œì§€
- ì´ëª¨ì§€ë¥¼ ì ì ˆíˆ í™œìš©
- ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ (1-3ë¬¸ì¥)
- ${recipientPersona.name}ë¼ëŠ” ì´ë¦„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©

ë©”ì‹œì§€ë§Œ ì¶œë ¥í•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª…ì€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.`;
        }

        // Gemini API ì„¤ì •
        const GEMINI_API_KEY = 'AIzaSyCmSdDLxkkF5tllaRx_rZ81jSqeY4wOwLY'; // ì—¬ê¸°ì— API í‚¤ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!

        // ëœë¤ ë©”ì‹œì§€ ìƒì„±
        async function generateRandomMessage(recipient) {
            const loadingEl = document.getElementById(`${recipient}RandomLoading`);
            const textarea = document.getElementById(`${recipient}Message`);
            
            // API í‚¤ í™•ì¸
            if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                alert('âš ï¸ Gemini API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!\nì½”ë“œì—ì„œ GEMINI_API_KEYë¥¼ ì°¾ì•„ ì‹¤ì œ API í‚¤ë¡œ ë³€ê²½í•˜ì„¸ìš”.');
                return;
            }
            
            loadingEl.classList.add('active');
            
            try {
                // í˜ë¥´ì†Œë‚˜ ì„¤ì •
                const isToMisae = recipient === 'bird';
                const sender = isToMisae ? 'dodo' : 'bird';
                
                let prompt = '';
                if (isToMisae) {
                    // ë„ë„ â†’ ë¯¸ìƒˆ
                    prompt = `ë‹¹ì‹ ì€ ë„ë„(ENTJ 8w9 so/sx, male, 43ì„¸, ì˜ì–´ êµìœ¡ ì½˜í…ì¸  íšŒì‚¬ CEO)ì…ë‹ˆë‹¤.
ë¯¸ìƒˆ(ENFJ 4w3 so/sx, female, 32ì„¸, ì±…ì„ ì‚¬ë‘í•˜ëŠ” ë¬¸í•™ì†Œë…€)ì—ê²Œ ë³´ë‚´ëŠ” ì§§ì€ í¸ì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

ê´€ê³„: 2024ë…„ 6ì›” 13ì¼ë¶€í„° ë§Œë‚œ ì—°ì¸ (ì•½ 5ê°œì›”)
í†¤: ì¥ë‚œìŠ¤ëŸ½ì§€ë§Œ ë‹¤ì •í•œ, ìœ ë¨¸ëŸ¬ìŠ¤í•˜ë©´ì„œ ë“ ë“ í•œ
íŠ¹ì§•:
- ë¯¸ìƒˆë¥¼ "ìš°íŒŒ"ë¼ê³  ì¥ë‚œì¹˜ë©° ë†€ë¦¼
- CEO ë§ˆì¸ë“œë¡œ ì‹¤ìš©ì ì´ë©´ì„œë„ ë”°ëœ»í•¨

ìš°ë¦¬ë§Œì˜ í‘œí˜„ (ìì—°ìŠ¤ëŸ½ê²Œ 1-2ê°œ ì‚¬ìš©):
- ì¢ŒíŒŒ/ìš°íŒŒ (ì •ì¹˜ì  ë†€ë¦¼)
- íŒŒë‹¥íŒŒë‹¥ / í‘¸ë“œë•í‘¸ë“œë•
- ë¼ì´ë‹¤ on!

2-4ë¬¸ì¥ì˜ ì§§ê³  ë”°ëœ»í•œ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ë©”ì‹œì§€ë§Œ ì‘ì„±í•˜ê³  ë‹¤ë¥¸ ì„¤ëª…ì€ í•˜ì§€ ë§ˆì„¸ìš”.`;
                } else {
                    // ë¯¸ìƒˆ â†’ ë„ë„
                    prompt = `ë‹¹ì‹ ì€ ë¯¸ìƒˆ(ENFJ 4w3 so/sx, female, 32ì„¸, ì±…ì„ ì‚¬ë‘í•˜ëŠ” ë¬¸í•™ì†Œë…€)ì…ë‹ˆë‹¤.
ë„ë„(ENTJ 8w9 so/sx, male, 43ì„¸, ì˜ì–´ êµìœ¡ ì½˜í…ì¸  íšŒì‚¬ CEO)ì—ê²Œ ë³´ë‚´ëŠ” ì§§ì€ í¸ì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

ê´€ê³„: 2024ë…„ 6ì›” 13ì¼ë¶€í„° ë§Œë‚œ ì—°ì¸ (ì•½ 5ê°œì›”)
í†¤: ì¥ë‚œìŠ¤ëŸ½ì§€ë§Œ ë‹¤ì •í•œ, ê°ì„±ì ì´ë©´ì„œë„ ë”°ëœ»í•œ
íŠ¹ì§•:
- ì±…ê³¼ ë¬¸í•™ì„ ì‚¬ë‘í•¨
- ìŠ¤ìŠ¤ë¡œë¥¼ ì¢ŒíŒŒë¼ê³  í•¨
- ENFJë‹µê²Œ ë”°ëœ»í•˜ê³  ê³µê°ì 
- 4w3 íŠ¹ì„±ìœ¼ë¡œ ê°ì„±ì ì´ê³  í‘œí˜„ì 

ìš°ë¦¬ë§Œì˜ í‘œí˜„ (ìì—°ìŠ¤ëŸ½ê²Œ 1-2ê°œ ì‚¬ìš©):
- ì¢ŒíŒŒ/ìš°íŒŒ (ì •ì¹˜ì  ë†ë‹´)
- íŒŒë‹¥íŒŒë‹¥ / í‘¸ë“œë•í‘¸ë“œë•
- ë¼ì´ë‹¤ on!

2-4ë¬¸ì¥ì˜ ì§§ê³  ë”°ëœ»í•œ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ë•Œë¡œëŠ” ì±… ê´€ë ¨ í‘œí˜„ì´ë‚˜ ê°ì„±ì ì¸ ë¬¸ì¥ì„ ì¨ë„ ì¢‹ìŠµë‹ˆë‹¤. ë©”ì‹œì§€ë§Œ ì‘ì„±í•˜ê³  ë‹¤ë¥¸ ì„¤ëª…ì€ í•˜ì§€ ë§ˆì„¸ìš”.`;
                }

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.9,
                            maxOutputTokens: 200,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                }

                const data = await response.json();
                const generatedMessage = data.candidates[0].content.parts[0].text.trim();
                
                textarea.value = generatedMessage;
                
            } catch (error) {
                console.error('ë©”ì‹œì§€ ìƒì„± ì‹¤íŒ¨:', error);
                alert('ğŸ˜… ë©”ì‹œì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!\n\nì˜¤ë¥˜: ' + error.message);
                
                // í´ë°±: ìƒ˜í”Œ ë©”ì‹œì§€
                const sampleMessages = recipient === 'bird' ? [
                    'ë¯¸ìƒˆì•¼, ì˜¤ëŠ˜ë„ íŒŒë‹¥íŒŒë‹¥! ğŸ’™ ì±… ì½ë‹¤ê°€ ìƒê°ë‚¬ì–´. ìš°ë¦¬ ìš°íŒŒ ë¯¸ìƒˆ ë³´ê³ ì‹¶ë‹¤~ ğŸ˜‚',
                    'ë¼ì´ë‹¤ on! ë¯¸ìƒˆì—ê²Œ ë„ì„œê´€ í•˜ë‚˜ ì‚¬ì¤„ê²Œ. í‘¸ë“œë•! ğŸ¦¤',
                    'ì˜¤ëŠ˜ í•˜ë£¨ë„ ê³ ìƒí–ˆì–´, ë¯¸ìƒˆ. ë‹¹ì‹ ì´ ìˆì–´ ë§¤ì¼ì´ íŠ¹ë³„í•´ìš” â¤ï¸'
                ] : [
                    'ë„ë„ì•¼, í‘¸ë“œë•í‘¸ë“œë•~ ì˜¤ëŠ˜ë„ CEOë‹˜ ìˆ˜ê³  ë§ìœ¼ì…¨ì–´ìš”! ğŸ’™ í•­ìƒ ì‘ì›í•´ ğŸ¦',
                    'íŒŒë‹¥íŒŒë‹¥! ì±… ì½ë‹¤ê°€ ë„ë„ ìƒê°ë‚¬ì–´. ë¼ì´ë‹¤ on! ğŸŒŸ',
                    'ë„ë„ì•¼, ë„ˆì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë“  ìˆœê°„ì´ ì†Œì¤‘í•´. ì˜¤ëŠ˜ë„ ì‚¬ë‘í•´! â¤ï¸'
                ];
                
                textarea.value = sampleMessages[Math.floor(Math.random() * sampleMessages.length)];
            } finally {
                loadingEl.classList.remove('active');
            }
        }
    </script>
</body>
</html>
